label: GPMS Obligations
rules:
  - label: create_proposal
    event:
      subject:
        anyUser:
      operations:
        - assign to
      target:
        policyElements:
          - name: PDS
            type: OA
    response:
      actions:
        - assign:
            what:
              - function:
                  name: current_user
            where:
              - name: PI
                type: UA
        - create:
            what:
              - function:
                  name: create_node
                  args: 
                    - function:
                        name: get_node_name 
                        args:
                          - function:
                              name: current_user
                    - O
            where:
              - name: PI-Info
                type: OA
               
  - label: submit_proposal
    event:
      subject:
      operations:
        - assign to
      target:
        policyElements:
          - name: Submission-Info
            type: OA
    response:
      actions:
        - deny:
            label: deny1
            subject:
              function: 
                name: current_user_to_deny_subject 
            operations:
               - w
            target:
              complement: false
              containers:
                - name: PI-Editable-Data
                  type: OA
        - deny:
            label: deny2
            subject:
              function: 
                name: get_user_to_deny_subject
                args: 
                  - CoPI
                  - UA 
            operations:
               - w
            target:
              complement: false
              containers:
                - name: CoPI-Editable-Data
                  type: OA 
        - deny:
            label: deny3
            subject:
              function: 
                name: current_user_to_deny_subject
            operations:
               - assign-u-from
            target:
              complement: false
              containers:
                - name: CoPI
                  type: UA 
        - deny:
            label: deny4
            subject:
              function: 
                name: get_user_to_deny_subject
                args: 
                  - CoPI
                  - UA 
            operations:
               - assign-u-to
            target:
              complement: false
              containers:
                - name: SP
                  type: UA 
        - deny:
            label: deny5
            subject:
              function: 
                name: get_user_to_deny_subject
                args: 
                  - CoPI
                  - UA 
            operations:
               - deassign-u-to
            target:
              complement: false
              containers:
                - name: SP
                  type: UA  
        - deny:
            label: deny6
            subject:
              function: 
                name: get_user_to_deny_subject
                args: 
                  - PI
                  - UA
            operations:
               - Save
            target:
              complement: false
              containers:
                - name: PDSs
                  type: OA
        - deny:
            label: deny7
            subject:
              function: 
                name: get_user_to_deny_subject
                args: 
                  - PI
                  - UA
            operations:
               - Delete
            target:
              complement: false
              containers:
                - name: PDSs
                  type: OA
        - deny:
            label: deny8
            subject:
              function: 
                name: get_user_to_deny_subject
                args: 
                  - PI
                  - UA
            operations:
               - Submit
            target:
              complement: false
              containers:
                - name: PDSs
                  type: OA    
                  
  - label: add_copi
    event:
      subject:
        anyUser:
      policyClass: 
         policyClass: Editing Policy       
      operations:
        - assign to
      target:
        policyElements:
          - name: CoPI
            type: UA
    response:
      actions:
        - create:
            what:
              - function:
                  name: create_node
                  args: 
                    - function:
                        name: get_node_name 
                        args:
                          - function:
                              name: email
                    - O
            where:
              - name: CoPI-Info
                type: OA
        - assign:
            what:
              - function:
                  name: child_of_assign
            where:
              - name: CoPI
                type: UA  
        - assign:
            what:
              - function:
                  name: findChairForCoPI
                  args: 
                    - function:
                        name: child_of_assign              
            where:
              - name: Chair
                type: UA
        - assign:
            what:
              - function:
                  name: findDeanForCoPI
                  args: 
                    - function:
                        name: child_of_assign              
            where:
              - name: Dean
                type: UA
        - assign:
            what:
              - function:
                  name: findBMForCoPI
                  args: 
                    - function:
                        name: child_of_assign              
            where:
              - name: Business-Manager
                type: UA                
                      
  - label: add_sp
    event:
      subject:
        anyUser:
      operations:
        - assign to
      target:
        policyElements:
          - name: SP
            type: UA
    response:
      actions:
        - create:
            what:
              - function:
                  name: create_node
                  args: 
                    - function:
                        name: get_node_name 
                        args:
                          - function:
                              name: child_of_assign
                    - O
            where:
              - name: SP-Info
                type: OA
        - assign:
            what:
              - function:
                  name: child_of_assign
            where:
              - name: SP
                type: UA  
  - label: delete_copi
    event:
      subject:
        anyUser:
      operations:
        - deassign from
      target:
        policyElements:
          - name: CoPI
            type: UA
    response:
      actions:
        - delete:
            assign:
              what: 
                - function:
                    name: child_of_assign
              where:
                - name: CoPI
                  type: UA
        - delete:
            create:
              what: 
                - function:
                    name: delete_node
                    args: 
                      - function:
                          name: get_node_name 
                          args:
                            - function:
                                name: child_of_assign
                      - O
                              
  - label: delete_sp
    event:
      subject:
        anyUser:
      operations:
        - deassign from
      target:
        policyElements:
          - name: SP
            type: UA
    response:
      actions:
        - delete:
            assign:
              what: 
                - function:
                    name: child_of_assign
              where:
                - name: SP
                  type: UA
        - delete:
            create:
              what: 
                - function:
                    name: delete_node
                    args: 
                      - function:
                          name: get_node_name 
                          args:
                            - function:
                                name: child_of_assign
                      - O
        
                
                    